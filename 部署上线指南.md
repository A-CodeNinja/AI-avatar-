# 快速部署指南 - 上线前必读

> **最后检查清单 + 一键配置**

---

## ✅ 部署前检查清单

### 1. 代码检查
- [x] AI生成功能已修复（接入真实API）
- [x] 民族风格系统已添加
- [x] 积分系统已优化（300积分/天）
- [x] openid bug已修复
- [x] 图标已替换为emoji（临时方案）

### 2. 配置检查
- [ ] 云函数环境变量已设置（必须！）
- [ ] 豆包API Key已填入：`98af736f-6038-4552-858f-3b7ef5a14d34`
- [ ] `AI_TYPE` 设置为 `doubao`
- [ ] 云函数已上传并部署

### 3. 功能测试
- [ ] 上传照片功能正常
- [ ] 选择风格功能正常
- [ ] 选择民族风格功能正常
- [ ] 生成头像功能成功（能看到新图片）
- [ ] 积分扣除正常
- [ ] 签到功能正常
- [ ] 观看广告功能正常（模拟）

---

## 🚀 一键部署步骤

### 步骤1: 配置云函数环境变量（最重要！）

1. **打开微信开发者工具**
2. **进入云开发控制台**
   - 点击顶部菜单"云开发"
   - 或按 `Ctrl+Shift+Y`

3. **找到云函数**
   - 点击左侧"云函数"
   - 找到 `generateAvatar`

4. **添加环境变量**
   - 点击"配置"按钮
   - 点击"环境变量"标签
   - 点击"添加"

5. **添加4个变量**（复制粘贴）：

```
变量名: AI_API_KEY
变量值: 98af736f-6038-4552-858f-3b7ef5a14d34

变量名: AI_API_URL
变量值: https://ark.cn-beijing.volces.com/api/v3/chat/completions

变量名: AI_MODEL
变量值: ep-20241101-xxxxx  （需要在豆包控制台查看）

变量名: AI_TYPE
变量值: doubao
```

6. **保存并部署**
   - 点击"确定"
   - 点击"上传并部署：云端安装依赖"

---

### 步骤2: 获取豆包模型ID

1. **登录火山引擎**
   - 访问：https://console.volcengine.com/ark

2. **创建推理端点**
   - 点击左侧"推理接入"
   - 点击"在线推理"
   - 点击"创建推理端点"

3. **复制端点ID**
   - 格式如：`ep-20241101-xxxxx`
   - 复制这个ID

4. **更新环境变量**
   - 回到微信开发者工具
   - 修改 `AI_MODEL` 的值为刚才复制的端点ID
   - 重新上传云函数

---

### 步骤3: 测试生成功能

1. **编译小程序**
   - 点击"编译"按钮
   - 或按 `Ctrl+B`

2. **上传照片**
   - 点击首页"上传照片"
   - 选择一张图片

3. **选择风格**
   - 选择"动漫"风格
   - （可选）选择"维吾尔族"风格

4. **生成头像**
   - 点击"立即生成 AI头像"
   - 等待3-10秒

5. **检查结果**
   - ✅ 成功：看到新的头像（不是原图）
   - ❌ 失败：查看云函数日志

---

### 步骤4: 查看云函数日志

如果生成失败，查看日志：

1. **在微信开发者工具中**
   - 进入"云开发"
   - 点击"云函数"
   - 找到 `generateAvatar`
   - 点击"日志"标签

2. **查看最新日志**
   - 看是否有错误信息
   - 特别关注 `AI_API_KEY`、`AI调用失败`等关键词

---

## 📋 环境变量完整列表

在云函数配置中，必须设置以下4个环境变量：

| 变量名 | 变量值 | 说明 |
|--------|--------|------|
| `AI_API_KEY` | `98af736f-6038-4552-858f-3b7ef5a14d34` | 豆包API密钥 |
| `AI_API_URL` | `https://ark.cn-beijing.volces.com/api/v3/chat/completions` | 豆包API地址 |
| `AI_MODEL` | `ep-20241101-xxxxx` | 推理端点ID |
| `AI_TYPE` | `doubao` | AI服务商类型 |

---

## 🔧 备用方案：使用通义千问

如果豆包AI出现问题，可以切换到通义千问：

### 修改环境变量：

| 变量名 | 新值 |
|--------|------|
| `AI_API_KEY` | `sk-6f6eee35951d4273b58ed94a53e53435` |
| `AI_API_URL` | （留空） |
| `AI_MODEL` | `wanx-v1` |
| `AI_TYPE` | `qianwen` |

### 重新部署：
- 修改完环境变量后
- 必须重新上传云函数

---

## ⚠️ 常见问题

### Q1: 环境变量设置了但还是报错？

**A**:
1. 检查变量名是否正确（必须大写）
2. 检查变量值是否正确（不要有空格）
3. 重新上传云函数

---

### Q2: 豆包API地址不对？

**A**: 豆包的文生图API地址可能不是这个，请参考：
- 火山引擎控制台 → 推理接入 → API文档
- 或者尝试通义千问备选方案

---

### Q3: 生成一直失败？

**A**:
1. 查看云函数日志
2. 检查 `AI_API_KEY` 是否有效
3. 尝试切换到通义千问

---

### Q4: 图标显示不出来？

**A**: 目前使用emoji作为临时图标，不影响功能：
- 📷 上传图标
- 🎨 风格图标
- 🌸 民族风格图标
- 📅 签到图标
- 🎬 广告图标
- 🎁 邀请图标

上线后可以替换为专业图标。

---

## 📊 功能完成度

### 已完成：
- [x] AI头像生成（真实实现）
- [x] 民族风格系统（5种）
- [x] 基础风格系统（8种）
- [x] 积分系统（300积分/天）
- [x] 素材库（头像框+贴纸）
- [x] 头像墙（官方+用户）
- [x] 用户中心

### 待完成（后续）：
- [ ] 生成示例图准备
- [ ] 民族风格参考图（250张）
- [ ] 专业图标设计
- [ ] 广告SDK接入
- [ ] 支付功能（会员+充值）

---

## 🎯 测试清单

### 功能测试：

| 功能 | 测试内容 | 通过？ |
|------|---------|-------|
| 上传照片 | 选择相册/拍照 | [ ] |
| 选择基础风格 | 选择动漫/3D/写实等 | [ ] |
| 选择民族风格 | 选择维吾尔/哈萨克等 | [ ] |
| 生成头像 | 看到新生成的图片 | [ ] |
| 积分扣除 | 积分-10 | [ ] |
| 保存图片 | 保存到相册 | [ ] |
| 签到 | 获得10-100积分 | [ ] |
| 头像墙 | 查看官方/用户头像 | [ ] |
| 素材库 | 查看头像框/贴纸 | [ ] |

---

## 📞 需要帮助？

### 查看文档：
- [云函数配置指南.md](./云函数配置指南.md)
- [快速开始指南.md](./快速开始指南.md)
- [完整实施方案.md](./完整实施方案.md)

### 查看日志：
- 云函数日志：云开发 → 云函数 → 日志
- 小程序日志：微信开发者工具控制台

---

## ✅ 部署成功标志

看到以下内容说明部署成功：

1. ✅ 云函数上传成功
2. ✅ 测试生成头像成功（看到新图片）
3. ✅ 积分系统正常
4. ✅ 民族风格可以选择
5. ✅ 无严重报错

---

## 🚀 准备上线

完成以上所有检查后：

1. **提交审核**
   - 进入微信小程序后台
   - 提交代码审核

2. **准备上线**
   - 准备小程序介绍文案
   - 准备截图（首页、生成页、结果页）

3. **正式上线**
   - 审核通过后发布
   - 开始推广

---

**祝你上线成功！** 🎉

有问题随时查阅相关文档！
