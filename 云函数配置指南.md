# 云函数配置指南 - 快速上手

> **重要：必须在微信云开发环境中设置环境变量！**

---

## 🚀 一键配置（推荐方式）

### 方法1: 微信开发者工具配置（最简单）

1. **打开微信开发者工具**
2. **进入云开发控制台**
   - 点击顶部菜单"云开发"
   - 或按快捷键 `Ctrl+Shift+Y`（Windows）/ `Cmd+Shift+Y`（Mac）

3. **找到云函数**
   - 点击左侧"云函数"
   - 找到 `generateAvatar` 云函数

4. **配置环境变量**
   - 点击 `generateAvatar` 右侧的"配置"按钮
   - 点击"环境变量"标签
   - 点击"添加"按钮

5. **添加以下4个环境变量**（复制粘贴即可）：

| 变量名 | 变量值 | 说明 |
|--------|--------|------|
| `AI_API_KEY` | `98af736f-6038-4552-858f-3b7ef5a14d34` | 豆包API密钥 |
| `AI_API_URL` | `https://ark.cn-beijing.volces.com/api/v3/chat/completions` | 豆包API地址 |
| `AI_MODEL` | `ep-20241101-xxxxx` | 模型ID（需要自己在豆包控制台查看） |
| `AI_TYPE` | `doubao` | AI服务商类型 |

6. **保存配置**
   - 点击"确定"保存
   - 点击"上传并部署：云端安装依赖"按钮

---

## 📝 获取豆包模型ID

### 步骤：

1. 登录火山引擎控制台：https://console.volcengine.com/ark
2. 点击左侧"推理接入"
3. 点击"在线推理"
4. 创建或选择一个推理端点
5. 复制端点ID（格式如：`ep-20241101-xxxxx`）
6. 将其填入 `AI_MODEL` 环境变量

---

## 🔧 备用方案：通义千问

如果想用通义千问（备用）：

### 1. 添加环境变量：

| 变量名 | 变量值 |
|--------|--------|
| `AI_API_KEY` | `sk-6f6eee35951d4273b58ed94a53e53435` |
| `AI_API_URL` | （留空或不填） |
| `AI_MODEL` | `wanx-v1` |
| `AI_TYPE` | `qianwen` |

### 2. 重新上传云函数

---

## ✅ 验证配置是否成功

### 测试步骤：

1. **打开小程序**
2. **上传一张照片**
3. **选择风格（如"动漫"）**
4. **点击"生成"**
5. **查看结果**：
   - ✅ 成功：看到新生成的头像（不是原图）
   - ❌ 失败：查看云函数日志

---

## 📊 查看云函数日志

### 方法1: 微信开发者工具

1. 进入"云开发"控制台
2. 点击"云函数"
3. 点击 `generateAvatar`
4. 点击"日志"标签
5. 查看最新日志

### 方法2: 云开发网页控制台

1. 访问：https://console.cloud.tencent.com/tcb
2. 选择你的环境：`cloud1-6g0jewt1e646e21b`
3. 点击"云函数" → `generateAvatar` → "日志"

---

## ❌ 常见错误及解决

### 错误1: AI_API_KEY not found

**原因**: 环境变量未设置

**解决**:
1. 检查云函数"配置"中是否有 `AI_API_KEY`
2. 重新上传云函数

---

### 错误2: AI调用失败

**原因**: API密钥错误或API地址不对

**解决**:
1. 检查 `AI_API_KEY` 是否正确
2. 检查 `AI_MODEL` 是否正确
3. 查看云函数日志中的详细错误信息

---

### 错误3: 生成速度太慢

**原因**: AI服务商响应慢

**解决**:
1. 使用豆包AI（最快，3-5秒）
2. 检查网络连接
3. 尝试切换AI服务商

---

## 📞 需要帮助？

### 查看日志：
- 云函数日志会显示详细错误信息
- 特别关注 `AI_API调用失败` 相关的错误

### 联系支持：
- 查看项目文档
- 检查环境变量配置
- 确认API密钥有效

---

## 🎯 快速检查清单

配置完成后，检查以下项目：

- [ ] 4个环境变量都已添加
- [ ] `AI_API_KEY` 值正确（豆包：98af736f-6038-4552-858f-3b7ef5a14d34）
- [ ] `AI_TYPE` 值为 `doubao`
- [ ] 云函数已上传并部署
- [ ] 测试生成功能成功

---

**提示**: 环境变量配置完成后，每次修改都需要重新上传云函数！

---

祝你配置顺利！🚀
